{
  "datasets": [
    {
      "name": "ds_kpi_total_tons_30d",
      "displayName": "KPI: Total Tons (Last 30 Days)",
      "queryLines": [
        "SELECT total_tons_last_30d AS total_tons_last_30d FROM mccain_ebc_catalog.ag_mfg.gold_counter_total_tons_last_30d "
      ]
    },
    {
      "name": "ds_kpi_raw_spend_30d",
      "displayName": "KPI: Raw Potato Spend (Last 30 Days)",
      "queryLines": [
        "SELECT raw_potato_spend_last_30d_usd AS raw_potato_spend_last_30d_usd FROM mccain_ebc_catalog.ag_mfg.gold_counter_raw_potato_spend_last_30d "
      ]
    },
    {
      "name": "ds_kpi_oee_avg_7d",
      "displayName": "KPI: OEE Performance Avg (Last 7 Days)",
      "queryLines": [
        "SELECT oee_performance_avg_last_7d AS oee_performance_avg_last_7d FROM mccain_ebc_catalog.ag_mfg.gold_counter_oee_performance_avg_last_7d "
      ]
    },
    {
      "name": "ds_kpi_downgrade_30d",
      "displayName": "KPI: Downgrade/Rework Exposure (Last 30 Days)",
      "queryLines": [
        "SELECT downgrade_rework_exposure_last_30d_usd AS downgrade_rework_exposure_last_30d_usd FROM mccain_ebc_catalog.ag_mfg.gold_counter_downgrade_rework_last_30d "
      ]
    },
    {
      "name": "ds_quality_daily_lines",
      "displayName": "Blend Intake Quality (Daily by Line)",
      "queryLines": [
        "SELECT lm.date AS date, lm.plant_name AS plant_name, lm.plant_line AS plant_line, lm.product_name AS product_name, pr.region AS region, pr.plant_id AS plant_id, lm.blend_dm_pct AS blend_dm_pct, lm.hours_under_quality AS hours_under_quality, lm.hours_over_quality AS hours_over_quality, lm.plant_line AS line_id, COALESCE(pss.min_dry_matter_pct, 21.8) AS pss_min_dm, COALESCE(pss.max_dry_matter_pct, 22.2) AS pss_max_dm, ((COALESCE(pss.min_dry_matter_pct, 21.8) + COALESCE(pss.max_dry_matter_pct, 22.2)) / 2.0) AS pss_target_dm, (lm.blend_dm_pct - ((COALESCE(pss.min_dry_matter_pct, 21.8) + COALESCE(pss.max_dry_matter_pct, 22.2)) / 2.0)) AS deviation_pp, CASE WHEN lm.blend_dm_pct < COALESCE(pss.min_dry_matter_pct, 21.8) - 0.3 THEN true ELSE false END AS under_quality_flag_derived, CASE WHEN lm.blend_dm_pct > COALESCE(pss.max_dry_matter_pct, 22.2) + 0.3 THEN true ELSE false END AS over_quality_flag_derived FROM mccain_ebc_catalog.ag_mfg.gold_line_hourly_metrics lm LEFT JOIN mccain_ebc_catalog.ag_mfg.silver_product_revenue_by_line pr ON lm.date = pr.date AND lm.plant_name = pr.plant_name AND lm.plant_line = pr.plant_line AND lm.product_name = pr.product_name LEFT JOIN mccain_ebc_catalog.ag_mfg.silver_product_specifications_pss pss ON lm.plant_name = pss.plant_name AND lm.plant_line = pss.plant_line AND lm.product_name = pss.product_name ORDER BY lm.date ASC, lm.plant_name ASC, lm.plant_line ASC "
      ]
    },
    {
      "name": "ds_defects_weekly_by_plant",
      "displayName": "End-of-Line Defects (Weekly by Plant and SKU)",
      "queryLines": [
        "SELECT q.week_start AS week_start, q.plant_name AS plant_name, q.plant_line AS plant_line, q.product_name AS product_name, q.plant_line AS line_id, q.plant_id AS plant_id, COALESCE(mp.region, 'NA') AS region, AVG(q.total_defect_points) AS defect_rate_pct FROM mccain_ebc_catalog.ag_mfg.gold_line_hourly_quality q LEFT JOIN (SELECT DISTINCT plant_name, region FROM mccain_ebc_catalog.ag_mfg.silver_product_revenue_by_line) mp ON q.plant_name = mp.plant_name GROUP BY q.week_start, q.plant_name, q.plant_line, q.product_name, q.plant_id, COALESCE(mp.region, 'NA') ORDER BY q.week_start ASC, q.plant_name ASC "
      ]
    },
    {
      "name": "ds_oee_daily_lines",
      "displayName": "OEE KPIs (Daily by Line)",
      "queryLines": [
        "SELECT kpis.date AS date, kpis.plant_name AS plant_name, kpis.plant_line AS plant_line, kpis.plant_line AS line_id, pr.region AS region, pr.plant_id AS plant_id, kpis.event_count AS event_count, kpis.total_downtime_min AS total_downtime_min, kpis.run_duration_min AS run_duration_min, kpis.qty_packed_kg AS qty_packed_kg, kpis.num_totes_on AS num_totes_on, kpis.oee_performance AS oee_performance, CASE WHEN (kpis.total_downtime_min + kpis.run_duration_min) > 0 THEN (kpis.total_downtime_min / (kpis.total_downtime_min + kpis.run_duration_min)) ELSE 0 END AS downtime_rate FROM mccain_ebc_catalog.ag_mfg.gold_oee_kpis kpis LEFT JOIN mccain_ebc_catalog.ag_mfg.silver_product_revenue_by_line pr ON kpis.date = pr.date AND kpis.plant_name = pr.plant_name AND kpis.plant_line = pr.plant_line ORDER BY kpis.date ASC, kpis.plant_name ASC, kpis.plant_line ASC "
      ]
    },
    {
      "name": "ds_oee_events",
      "displayName": "Downtime Events",
      "queryLines": [
        "SELECT e.event_id AS event_id, e.plant_name AS plant_name, e.plant_line AS plant_line, eq.plant_id AS plant_id, e.event_time AS event_time, CAST(e.event_time AS DATE) AS event_date, e.duration_min AS duration_min, e.downtime_min AS downtime_min, e.code AS code, e.component AS component, e.notes AS notes FROM mccain_ebc_catalog.ag_mfg.silver_oee_events e LEFT JOIN (SELECT DISTINCT plant_name, plant_line, plant_id FROM mccain_ebc_catalog.ag_mfg.silver_line_equipment) eq ON e.plant_name = eq.plant_name AND e.plant_line = eq.plant_line ORDER BY e.event_time DESC "
      ]
    },
    {
      "name": "ds_cumulative_costs_region",
      "displayName": "Cumulative Costs by Region",
      "queryLines": [
        "SELECT date AS date, region AS region, cumulative_spend_usd AS cumulative_spend_usd, cumulative_over_quality_waste_usd AS cumulative_over_quality_waste_usd, cumulative_gross_margin_usd AS cumulative_gross_margin_usd FROM mccain_ebc_catalog.ag_mfg.gold_cumulative_costs ORDER BY date ASC, region ASC "
      ]
    },
    {
      "name": "ds_scenario_recommendations",
      "displayName": "Scenario Recommendations",
      "queryLines": [
        "SELECT r.recommendation_id AS recommendation_id, r.type AS type, r.plant_name AS plant_name, r.plant_line AS plant_line, eq.plant_id AS plant_id, r.expected_savings_usd AS expected_savings_usd, CAST(r.expected_quality_delta_pp AS DOUBLE) AS expected_quality_delta_pp, CAST(r.confidence AS DOUBLE) AS confidence, r.rationale AS rationale FROM mccain_ebc_catalog.ag_mfg.gold_scenario_recommendations r LEFT JOIN (SELECT DISTINCT plant_name, plant_line, plant_id FROM mccain_ebc_catalog.ag_mfg.silver_line_equipment) eq ON r.plant_name = eq.plant_name AND r.plant_line = eq.plant_line ORDER BY r.expected_savings_usd DESC, r.type ASC "
      ]
    }
  ],
  "pages": [
    {
      "name": "manufacturing_quality_oee_cost_main",
      "displayName": "Production Quality, OEE, and Cost Exposure",
      "layout": [
        {
          "widget": {
            "name": "header_intro",
            "multilineTextboxSpec": {
              "lines": [
                "# Production Quality, OEE, and Cost Exposure\n",
                "Executive monitoring of blend intake quality vs PSS, OSI PI end-of-line quality, OEE performance, downtime events, and financial exposure. Highlights sustained over-quality at EU-NL-P03 L2 and under-quality at NA-ID-P01 L3, ties to supplier mix shift and equipment throughput constraints, and quantifies cost impacts.\n"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 0,
            "width": 6,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "kpi_total_tons_30d",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_kpi_total_tons_30d",
                  "fields": [
                    {
                      "name": "sum(total_tons_last_30d)",
                      "expression": "SUM(`total_tons_last_30d`)"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "counter",
              "encodings": {
                "value": {
                  "fieldName": "sum(total_tons_last_30d)",
                  "displayName": "Total Tons (Last 30 Days)",
                  "format": {
                    "type": "number",
                    "decimalPlaces": {
                      "type": "max",
                      "places": 0
                    }
                  }
                }
              },
              "frame": {
                "title": "Total Tons Processed (Last 30 Days)",
                "showTitle": true,
                "description": "Sum of tons_processed over trailing 30 days across all plants/lines (context for throughput scale).",
                "showDescription": true
              }
            }
          },
          "position": {
            "x": 0,
            "y": 2,
            "width": 2,
            "height": 3
          }
        },
        {
          "widget": {
            "name": "kpi_raw_spend_30d",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_kpi_raw_spend_30d",
                  "fields": [
                    {
                      "name": "sum(raw_potato_spend_last_30d_usd)",
                      "expression": "SUM(`raw_potato_spend_last_30d_usd`)"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "counter",
              "encodings": {
                "value": {
                  "fieldName": "sum(raw_potato_spend_last_30d_usd)",
                  "displayName": "Raw Potato Spend (Last 30 Days, $)",
                  "format": {
                    "type": "number-currency",
                    "currencyCode": "USD",
                    "abbreviation": "compact",
                    "decimalPlaces": {
                      "type": "max",
                      "places": 2
                    }
                  }
                }
              },
              "frame": {
                "title": "Raw Potato Spend (Last 30 Days, $)",
                "showTitle": true,
                "description": "Sum of raw potato spend USD over trailing 30 days.",
                "showDescription": true
              }
            }
          },
          "position": {
            "x": 2,
            "y": 2,
            "width": 2,
            "height": 3
          }
        },
        {
          "widget": {
            "name": "kpi_oee_avg_7d",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_kpi_oee_avg_7d",
                  "fields": [
                    {
                      "name": "avg(oee_performance_avg_last_7d)",
                      "expression": "AVG(`oee_performance_avg_last_7d`)"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "widgetType": "counter",
              "encodings": {
                "value": {
                  "fieldName": "avg(oee_performance_avg_last_7d)",
                  "displayName": "OEE Performance (Avg Last 7 Days)",
                  "format": {
                    "type": "number",
                    "decimalPlaces": {
                      "type": "max",
                      "places": 1
                    }
                  }
                }
              },
              "frame": {
                "title": "OEE Performance (Avg Last 7 Days)",
                "showTitle": true,
                "description": "Average OEE performance over trailing 7 days.",
                "showDescription": true
              }
            }
          },
          "position": {
            "x": 4,
            "y": 2,
            "width": 1,
            "height": 3
          }
        },
        {
          "widget": {
            "name": "kpi_downgrade_rework_30d",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_kpi_downgrade_30d",
                  "fields": [
                    {
                      "name": "sum(downgrade_rework_exposure_last_30d_usd)",
                      "expression": "SUM(`downgrade_rework_exposure_last_30d_usd`)"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "widgetType": "counter",
              "encodings": {
                "value": {
                  "fieldName": "sum(downgrade_rework_exposure_last_30d_usd)",
                  "displayName": "Downgrade/Rework Cost Exposure (Last 30 Days, $)",
                  "format": {
                    "type": "number-currency",
                    "currencyCode": "USD",
                    "abbreviation": "compact",
                    "decimalPlaces": {
                      "type": "max",
                      "places": 2
                    }
                  }
                }
              },
              "frame": {
                "title": "Downgrade/Rework Cost Exposure (Last 30 Days, $)",
                "showTitle": true,
                "description": "Aggregated downgrade/rework exposure USD over trailing 30 days.",
                "showDescription": true
              }
            }
          },
          "position": {
            "x": 5,
            "y": 2,
            "width": 1,
            "height": 3
          }
        },
        {
          "widget": {
            "name": "header_quality",
            "multilineTextboxSpec": {
              "lines": [
                "## Quality Signals \u2014 Blend Intake vs Targets and End-of-Line Defects\n",
                "Sustained over-quality at EU-NL-P03 L2 (SC-9mm) and under-quality at NA-ID-P01 L3 (CC-13mm) around the 2025-08-18..2025-09-12 trigger window.\n"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 5,
            "width": 6,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "blend_intake_dm_daily_by_line",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_quality_daily_lines",
                  "fields": [
                    {
                      "name": "daily(date)",
                      "expression": "DATE_TRUNC(\"DAY\", `date`)"
                    },
                    {
                      "name": "line_id",
                      "expression": "`line_id`"
                    },
                    {
                      "name": "avg(blend_dm_pct)",
                      "expression": "AVG(`blend_dm_pct`)"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "widgetType": "line",
              "encodings": {
                "x": {
                  "fieldName": "daily(date)",
                  "scale": {
                    "type": "temporal"
                  },
                  "axis": {
                    "title": "Date"
                  },
                  "displayName": "Date"
                },
                "y": {
                  "fieldName": "avg(blend_dm_pct)",
                  "scale": {
                    "type": "quantitative"
                  },
                  "axis": {
                    "title": "Avg Blend DM (%)"
                  },
                  "displayName": "Avg Blend DM (%)"
                },
                "color": {
                  "fieldName": "line_id",
                  "scale": {
                    "type": "categorical"
                  },
                  "displayName": "Line"
                }
              },
              "frame": {
                "showTitle": true,
                "title": "Blend Intake DM vs Target (Daily by Line)",
                "description": "X: date (daily); Y: avg blend_dm_pct; color: line_id (e.g., EU-NL-P03 L2 over-target, NA-ID-P01 L3 under-target).",
                "showDescription": true
              }
            }
          },
          "position": {
            "x": 0,
            "y": 7,
            "width": 3,
            "height": 5
          }
        },
        {
          "widget": {
            "name": "defect_rate_weekly_grouped_by_plant",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_defects_weekly_by_plant",
                  "fields": [
                    {
                      "name": "weekly(week_start)",
                      "expression": "DATE_TRUNC(\"WEEK\", `week_start`)"
                    },
                    {
                      "name": "plant_name",
                      "expression": "`plant_name`"
                    },
                    {
                      "name": "avg(defect_rate_pct)",
                      "expression": "AVG(`defect_rate_pct`)"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "widgetType": "bar",
              "encodings": {
                "x": {
                  "fieldName": "weekly(week_start)",
                  "scale": {
                    "type": "temporal"
                  },
                  "axis": {
                    "title": "Week Start"
                  },
                  "displayName": "Week Start"
                },
                "y": {
                  "fieldName": "avg(defect_rate_pct)",
                  "scale": {
                    "type": "quantitative"
                  },
                  "axis": {
                    "title": "Avg End-of-Line Defect Points"
                  },
                  "displayName": "Avg End-of-Line Defect Points"
                },
                "color": {
                  "fieldName": "plant_name",
                  "scale": {
                    "type": "categorical"
                  },
                  "displayName": "Plant"
                }
              },
              "mark": {
                "layout": "group"
              },
              "frame": {
                "showTitle": true,
                "title": "End-of-Line Defect Rate by Plant (Weekly Grouped Bars)",
                "description": "Grouped bars per week by plant; highlights NA-ID-P01 elevations during 2025-08-22..2025-09-05.",
                "showDescription": true
              }
            }
          },
          "position": {
            "x": 3,
            "y": 7,
            "width": 3,
            "height": 5
          }
        },
        {
          "widget": {
            "name": "header_oee",
            "multilineTextboxSpec": {
              "lines": [
                "## OEE Performance and Downtime Traceability\n",
                "Performance dips and downtime clusters align with under-quality on NA-ID-P01 L3; trace event IDs (e.g., DOW-PI-4521, DOW-PI-4574).\n"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 12,
            "width": 6,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "oee_performance_daily_by_line",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_oee_daily_lines",
                  "fields": [
                    {
                      "name": "daily(date)",
                      "expression": "DATE_TRUNC(\"DAY\", `date`)"
                    },
                    {
                      "name": "avg(oee_performance)",
                      "expression": "AVG(`oee_performance`)"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "widgetType": "line",
              "encodings": {
                "x": {
                  "fieldName": "daily(date)",
                  "scale": {
                    "type": "temporal"
                  },
                  "axis": {
                    "title": "Date"
                  },
                  "displayName": "Date"
                },
                "y": {
                  "fieldName": "avg(oee_performance)",
                  "scale": {
                    "type": "quantitative"
                  },
                  "axis": {
                    "title": "OEE Performance"
                  },
                  "displayName": "OEE Performance"
                },
                "color": {
                  "fieldName": "line_id",
                  "scale": {
                    "type": "categorical"
                  },
                  "displayName": "Line"
                }
              },
              "frame": {
                "showTitle": true,
                "title": "OEE Components (Daily Lines)",
                "description": "X: date (daily); Y: avg oee_performance; color: line_id. Performance dips around downtime events at NA-ID-P01 L3.",
                "showDescription": true
              }
            }
          },
          "position": {
            "x": 0,
            "y": 14,
            "width": 3,
            "height": 5
          }
        },
        {
          "widget": {
            "name": "downtime_events_table",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_oee_events",
                  "fields": [
                    {
                      "name": "event_id",
                      "expression": "`event_id`"
                    },
                    {
                      "name": "plant_name",
                      "expression": "`plant_name`"
                    },
                    {
                      "name": "plant_line",
                      "expression": "`plant_line`"
                    },
                    {
                      "name": "event_time",
                      "expression": "`event_time`"
                    },
                    {
                      "name": "duration_min",
                      "expression": "`duration_min`"
                    },
                    {
                      "name": "code",
                      "expression": "`code`"
                    },
                    {
                      "name": "component",
                      "expression": "`component`"
                    },
                    {
                      "name": "notes",
                      "expression": "`notes`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 3,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "event_id",
                    "displayName": "Event ID",
                    "type": "string",
                    "displayAs": "string"
                  },
                  {
                    "fieldName": "plant_name",
                    "displayName": "Plant",
                    "type": "string",
                    "displayAs": "string"
                  },
                  {
                    "fieldName": "plant_line",
                    "displayName": "Line",
                    "type": "string",
                    "displayAs": "string"
                  },
                  {
                    "fieldName": "event_time",
                    "displayName": "Event Time",
                    "type": "timestamp",
                    "displayAs": "datetime",
                    "dateTimeFormat": "YYYY-MM-DD HH:mm"
                  },
                  {
                    "fieldName": "duration_min",
                    "displayName": "Duration (min)",
                    "type": "float",
                    "displayAs": "number",
                    "numberFormat": "0"
                  },
                  {
                    "fieldName": "code",
                    "displayName": "Code",
                    "type": "string",
                    "displayAs": "string"
                  },
                  {
                    "fieldName": "component",
                    "displayName": "Component",
                    "type": "string",
                    "displayAs": "string"
                  },
                  {
                    "fieldName": "notes",
                    "displayName": "Notes",
                    "type": "string",
                    "displayAs": "string"
                  }
                ]
              },
              "itemsPerPage": 12,
              "frame": {
                "showTitle": true,
                "title": "Downtime Events Table",
                "description": "Trace DOW-PI-4521 and DOW-PI-4574 on NA-ID-P01 L3; sort by latest event_time.",
                "showDescription": true
              }
            }
          },
          "position": {
            "x": 3,
            "y": 14,
            "width": 3,
            "height": 5
          }
        },
        {
          "widget": {
            "name": "header_financial",
            "multilineTextboxSpec": {
              "lines": [
                "## Financial Exposure \u2014 Spend vs Over-Quality Waste and Recommendations\n",
                "Stacked cumulative spend by region with overlay of cumulative over-quality waste; top scenario suggestions for human-in-the-loop review.\n"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 19,
            "width": 6,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "cumulative_spend_vs_waste_by_region",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_cumulative_costs_region",
                  "fields": [
                    {
                      "name": "daily(date)",
                      "expression": "DATE_TRUNC(\"DAY\", `date`)"
                    },
                    {
                      "name": "region",
                      "expression": "`region`"
                    },
                    {
                      "name": "sum(cumulative_spend_usd)",
                      "expression": "SUM(`cumulative_spend_usd`)"
                    },
                    {
                      "name": "sum(cumulative_over_quality_waste_usd)",
                      "expression": "SUM(`cumulative_over_quality_waste_usd`)"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "widgetType": "bar",
              "encodings": {
                "x": {
                  "fieldName": "daily(date)",
                  "scale": {
                    "type": "temporal"
                  },
                  "axis": {
                    "title": "Date"
                  },
                  "displayName": "Date"
                },
                "y": {
                  "fieldName": "sum(cumulative_spend_usd)",
                  "scale": {
                    "type": "quantitative"
                  },
                  "format": {
                    "type": "number-currency",
                    "currencyCode": "USD",
                    "abbreviation": "compact",
                    "decimalPlaces": {
                      "type": "max",
                      "places": 0
                    }
                  },
                  "axis": {
                    "title": "Cumulative Spend ($)"
                  },
                  "displayName": "Cumulative Spend ($)"
                },
                "y2": {
                  "fieldName": "sum(cumulative_over_quality_waste_usd)",
                  "scale": {
                    "type": "quantitative"
                  },
                  "format": {
                    "type": "number-currency",
                    "currencyCode": "USD",
                    "abbreviation": "compact",
                    "decimalPlaces": {
                      "type": "max",
                      "places": 0
                    }
                  },
                  "axis": {
                    "title": "Cumulative Over-Quality Waste ($)"
                  },
                  "displayName": "Cumulative Over-Quality Waste ($)"
                },
                "color": {
                  "fieldName": "region",
                  "scale": {
                    "type": "categorical"
                  },
                  "displayName": "Region"
                }
              },
              "frame": {
                "showTitle": true,
                "title": "Raw Potato Spend vs Over-Quality Waste (Cumulative by Region)",
                "description": "Stacked cumulative spend by region; overlay cumulative over-quality waste to show EU-NL-P03 contributions.",
                "showDescription": true
              }
            }
          },
          "position": {
            "x": 0,
            "y": 21,
            "width": 3,
            "height": 5
          }
        },
        {
          "widget": {
            "name": "scenario_suggestions_table",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_scenario_recommendations",
                  "fields": [
                    {
                      "name": "recommendation_id",
                      "expression": "`recommendation_id`"
                    },
                    {
                      "name": "type",
                      "expression": "`type`"
                    },
                    {
                      "name": "plant_name",
                      "expression": "`plant_name`"
                    },
                    {
                      "name": "plant_line",
                      "expression": "`plant_line`"
                    },
                    {
                      "name": "expected_savings_usd",
                      "expression": "`expected_savings_usd`"
                    },
                    {
                      "name": "expected_quality_delta_pp",
                      "expression": "`expected_quality_delta_pp`"
                    },
                    {
                      "name": "confidence",
                      "expression": "`confidence`"
                    },
                    {
                      "name": "rationale",
                      "expression": "`rationale`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "recommendation_id",
                    "displayName": "Recommendation ID",
                    "type": "string",
                    "displayAs": "string"
                  },
                  {
                    "fieldName": "type",
                    "displayName": "Type",
                    "type": "string",
                    "displayAs": "string"
                  },
                  {
                    "fieldName": "plant_name",
                    "displayName": "Plant",
                    "type": "string",
                    "displayAs": "string"
                  },
                  {
                    "fieldName": "plant_line",
                    "displayName": "Line",
                    "type": "string",
                    "displayAs": "string"
                  },
                  {
                    "fieldName": "expected_savings_usd",
                    "displayName": "Expected Savings ($)",
                    "type": "float",
                    "displayAs": "number",
                    "numberFormat": "0,0"
                  },
                  {
                    "fieldName": "expected_quality_delta_pp",
                    "displayName": "Expected Quality \u0394 (pp)",
                    "type": "float",
                    "displayAs": "number",
                    "numberFormat": "0.0"
                  },
                  {
                    "fieldName": "confidence",
                    "displayName": "Confidence",
                    "type": "float",
                    "displayAs": "number",
                    "numberFormat": "0.0"
                  },
                  {
                    "fieldName": "rationale",
                    "displayName": "Rationale",
                    "type": "string",
                    "displayAs": "string"
                  }
                ]
              },
              "itemsPerPage": 10,
              "frame": {
                "showTitle": true,
                "title": "Scenario Suggestions (Top Recommendations)",
                "description": "Load reallocation and equipment upgrades with expected savings, quality uplift, and confidence.",
                "showDescription": true
              }
            }
          },
          "position": {
            "x": 3,
            "y": 21,
            "width": 3,
            "height": 5
          }
        }
      ],
      "pageType": "PAGE_TYPE_CANVAS"
    },
    {
      "name": "global_filters",
      "displayName": "Global Filters",
      "layout": [
        {
          "widget": {
            "name": "filter_date_range",
            "queries": [
              {
                "name": "ds_quality_daily_lines_date",
                "query": {
                  "datasetName": "ds_quality_daily_lines",
                  "fields": [
                    {
                      "name": "date",
                      "expression": "`date`"
                    }
                  ],
                  "disaggregated": false
                }
              },
              {
                "name": "ds_defects_weekly_by_plant_week_start",
                "query": {
                  "datasetName": "ds_defects_weekly_by_plant",
                  "fields": [
                    {
                      "name": "week_start",
                      "expression": "`week_start`"
                    }
                  ],
                  "disaggregated": false
                }
              },
              {
                "name": "ds_oee_daily_lines_date",
                "query": {
                  "datasetName": "ds_oee_daily_lines",
                  "fields": [
                    {
                      "name": "date",
                      "expression": "`date`"
                    }
                  ],
                  "disaggregated": false
                }
              },
              {
                "name": "ds_oee_events_event_date",
                "query": {
                  "datasetName": "ds_oee_events",
                  "fields": [
                    {
                      "name": "event_date",
                      "expression": "`event_date`"
                    }
                  ],
                  "disaggregated": false
                }
              },
              {
                "name": "ds_cumulative_costs_region_date",
                "query": {
                  "datasetName": "ds_cumulative_costs_region",
                  "fields": [
                    {
                      "name": "date",
                      "expression": "`date`"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "filter-date-range-picker",
              "encodings": {
                "fields": [
                  {
                    "fieldName": "date",
                    "displayName": "Date",
                    "queryName": "ds_quality_daily_lines_date"
                  },
                  {
                    "fieldName": "week_start",
                    "displayName": "Week Start",
                    "queryName": "ds_defects_weekly_by_plant_week_start"
                  },
                  {
                    "fieldName": "date",
                    "displayName": "Date",
                    "queryName": "ds_oee_daily_lines_date"
                  },
                  {
                    "fieldName": "event_date",
                    "displayName": "Event Date",
                    "queryName": "ds_oee_events_event_date"
                  },
                  {
                    "fieldName": "date",
                    "displayName": "Date",
                    "queryName": "ds_cumulative_costs_region_date"
                  }
                ]
              },
              "frame": {
                "showTitle": true
              }
            }
          },
          "position": {
            "x": 0,
            "y": 0,
            "width": 2,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "filter_region",
            "queries": [
              {
                "name": "ds_quality_daily_lines_region",
                "query": {
                  "datasetName": "ds_quality_daily_lines",
                  "fields": [
                    {
                      "name": "region",
                      "expression": "`region`"
                    }
                  ],
                  "disaggregated": false
                }
              },
              {
                "name": "ds_defects_weekly_by_plant_region",
                "query": {
                  "datasetName": "ds_defects_weekly_by_plant",
                  "fields": [
                    {
                      "name": "region",
                      "expression": "`region`"
                    }
                  ],
                  "disaggregated": false
                }
              },
              {
                "name": "ds_oee_daily_lines_region",
                "query": {
                  "datasetName": "ds_oee_daily_lines",
                  "fields": [
                    {
                      "name": "region",
                      "expression": "`region`"
                    }
                  ],
                  "disaggregated": false
                }
              },
              {
                "name": "ds_cumulative_costs_region_region",
                "query": {
                  "datasetName": "ds_cumulative_costs_region",
                  "fields": [
                    {
                      "name": "region",
                      "expression": "`region`"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "filter-single-select",
              "encodings": {
                "fields": [
                  {
                    "fieldName": "region",
                    "displayName": "Region",
                    "queryName": "ds_quality_daily_lines_region"
                  },
                  {
                    "fieldName": "region",
                    "displayName": "Region",
                    "queryName": "ds_defects_weekly_by_plant_region"
                  },
                  {
                    "fieldName": "region",
                    "displayName": "Region",
                    "queryName": "ds_oee_daily_lines_region"
                  },
                  {
                    "fieldName": "region",
                    "displayName": "Region",
                    "queryName": "ds_cumulative_costs_region_region"
                  }
                ]
              },
              "frame": {
                "showTitle": true
              }
            }
          },
          "position": {
            "x": 0,
            "y": 2,
            "width": 2,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "filter_plant_id",
            "queries": [
              {
                "name": "ds_quality_daily_lines_plant_id",
                "query": {
                  "datasetName": "ds_quality_daily_lines",
                  "fields": [
                    {
                      "name": "plant_id",
                      "expression": "`plant_id`"
                    }
                  ],
                  "disaggregated": false
                }
              },
              {
                "name": "ds_defects_weekly_by_plant_plant_id",
                "query": {
                  "datasetName": "ds_defects_weekly_by_plant",
                  "fields": [
                    {
                      "name": "plant_id",
                      "expression": "`plant_id`"
                    }
                  ],
                  "disaggregated": false
                }
              },
              {
                "name": "ds_oee_daily_lines_plant_id",
                "query": {
                  "datasetName": "ds_oee_daily_lines",
                  "fields": [
                    {
                      "name": "plant_id",
                      "expression": "`plant_id`"
                    }
                  ],
                  "disaggregated": false
                }
              },
              {
                "name": "ds_scenario_recommendations_plant_id",
                "query": {
                  "datasetName": "ds_scenario_recommendations",
                  "fields": [
                    {
                      "name": "plant_id",
                      "expression": "`plant_id`"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "filter-single-select",
              "encodings": {
                "fields": [
                  {
                    "fieldName": "plant_id",
                    "displayName": "Plant ID",
                    "queryName": "ds_quality_daily_lines_plant_id"
                  },
                  {
                    "fieldName": "plant_id",
                    "displayName": "Plant ID",
                    "queryName": "ds_defects_weekly_by_plant_plant_id"
                  },
                  {
                    "fieldName": "plant_id",
                    "displayName": "Plant ID",
                    "queryName": "ds_oee_daily_lines_plant_id"
                  },
                  {
                    "fieldName": "plant_id",
                    "displayName": "Plant ID",
                    "queryName": "ds_scenario_recommendations_plant_id"
                  }
                ]
              },
              "frame": {
                "showTitle": true
              }
            }
          },
          "position": {
            "x": 0,
            "y": 4,
            "width": 2,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "filter_line_id",
            "queries": [
              {
                "name": "ds_quality_daily_lines_line_id",
                "query": {
                  "datasetName": "ds_quality_daily_lines",
                  "fields": [
                    {
                      "name": "line_id",
                      "expression": "`line_id`"
                    }
                  ],
                  "disaggregated": false
                }
              },
              {
                "name": "ds_defects_weekly_by_plant_line_id",
                "query": {
                  "datasetName": "ds_defects_weekly_by_plant",
                  "fields": [
                    {
                      "name": "line_id",
                      "expression": "`line_id`"
                    }
                  ],
                  "disaggregated": false
                }
              },
              {
                "name": "ds_oee_daily_lines_line_id",
                "query": {
                  "datasetName": "ds_oee_daily_lines",
                  "fields": [
                    {
                      "name": "line_id",
                      "expression": "`line_id`"
                    }
                  ],
                  "disaggregated": false
                }
              },
              {
                "name": "ds_oee_events_line",
                "query": {
                  "datasetName": "ds_oee_events",
                  "fields": [
                    {
                      "name": "plant_line",
                      "expression": "`plant_line`"
                    }
                  ],
                  "disaggregated": false
                }
              },
              {
                "name": "ds_scenario_recommendations_line",
                "query": {
                  "datasetName": "ds_scenario_recommendations",
                  "fields": [
                    {
                      "name": "plant_line",
                      "expression": "`plant_line`"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "filter-multi-select",
              "encodings": {
                "fields": [
                  {
                    "fieldName": "line_id",
                    "displayName": "Line",
                    "queryName": "ds_quality_daily_lines_line_id",
                    "dataType": "STRING"
                  },
                  {
                    "fieldName": "line_id",
                    "displayName": "Line",
                    "queryName": "ds_defects_weekly_by_plant_line_id",
                    "dataType": "STRING"
                  },
                  {
                    "fieldName": "line_id",
                    "displayName": "Line",
                    "queryName": "ds_oee_daily_lines_line_id",
                    "dataType": "STRING"
                  },
                  {
                    "fieldName": "plant_line",
                    "displayName": "Line",
                    "queryName": "ds_oee_events_line",
                    "dataType": "STRING"
                  },
                  {
                    "fieldName": "plant_line",
                    "displayName": "Line",
                    "queryName": "ds_scenario_recommendations_line",
                    "dataType": "STRING"
                  }
                ]
              },
              "frame": {
                "showTitle": true
              }
            }
          },
          "position": {
            "x": 0,
            "y": 6,
            "width": 2,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "filter_sku",
            "queries": [
              {
                "name": "ds_quality_daily_lines_sku",
                "query": {
                  "datasetName": "ds_quality_daily_lines",
                  "fields": [
                    {
                      "name": "product_name",
                      "expression": "`product_name`"
                    }
                  ],
                  "disaggregated": false
                }
              },
              {
                "name": "ds_defects_weekly_by_plant_sku",
                "query": {
                  "datasetName": "ds_defects_weekly_by_plant",
                  "fields": [
                    {
                      "name": "product_name",
                      "expression": "`product_name`"
                    }
                  ],
                  "disaggregated": false
                }
              },
              {
                "name": "ds_oee_daily_lines_sku",
                "query": {
                  "datasetName": "ds_oee_daily_lines",
                  "fields": [
                    {
                      "name": "product_name",
                      "expression": "`product_name`"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "filter-multi-select",
              "encodings": {
                "fields": [
                  {
                    "fieldName": "product_name",
                    "displayName": "SKU",
                    "queryName": "ds_quality_daily_lines_sku",
                    "dataType": "STRING"
                  },
                  {
                    "fieldName": "product_name",
                    "displayName": "SKU",
                    "queryName": "ds_defects_weekly_by_plant_sku",
                    "dataType": "STRING"
                  },
                  {
                    "fieldName": "product_name",
                    "displayName": "SKU",
                    "queryName": "ds_oee_daily_lines_sku",
                    "dataType": "STRING"
                  }
                ]
              },
              "frame": {
                "showTitle": true
              }
            }
          },
          "position": {
            "x": 0,
            "y": 8,
            "width": 2,
            "height": 2
          }
        }
      ],
      "pageType": "PAGE_TYPE_GLOBAL_FILTERS"
    }
  ],
  "uiSettings": {
    "theme": {
      "widgetHeaderAlignment": "ALIGNMENT_UNSPECIFIED"
    }
  }
}